# 内核选择 (Kernel Selection)

如前所述，复杂的计算密集型操作非常复杂，需要许多技巧才能获得最佳性能。然而，这些技巧的应用方式因硬件和问题形状而异。为了选择最佳内核，我们使用搜索方法和高度可配置的自动调优系统，在当前硬件上运行时执行微基准测试。

这可能会触发冷启动，但这些基准测试的结果会缓存在磁盘上供后续执行使用。

对于在 spot 实例上部署或训练，将自动调优缓存与代码捆绑是一个好主意，以减轻冷启动。有关细粒度设置的更多详细信息，请参考 <a href="https://burn.dev/books/cubecl/advanced-usage/config.html">CubeCL 配置文档</a>。

从用户的角度来看，内核选择应该不是问题，但像往常一样，设计具有均匀形状的张量，8 的倍数，可以显著提高性能。避免创建形状为 10 的倍数的张量，如 `[1000, 1000]`，因为这些通常需要边界检查，并可能限制向量化。

更喜欢像 `[1024, 1024]` 这样的形状，其中维度是 32 的倍数或 2 的幂，因为这些通常是最优的。如果别无选择只能使用次优形状，宁愿在单个内核中处理它，将其转换为最优形状。有一个慢的神经网络层后跟快速的层，比传播不均匀性最终导致更小但更慢的层要好。

---

*本文档翻译自 Burn 官方文档：https://burn.dev/books/burn/performance/good-practices/kernel-selection.html*
